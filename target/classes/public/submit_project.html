<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Soumettre un Projet</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <header class="text-center py-4 bg-primary text-white shadow">
    <h1>MaVille</h1>
    <p>Soumettre un Projet</p>
  </header>

  <div class="container mt-3">
    <button onclick="window.history.back();" class="btn btn-outline-secondary mb-4">
      <i class="bi bi-arrow-left"></i> Retour
    </button>
  </div>

  <div class="container mt-5">
    <h2 class="text-center mb-4">Nouveau Projet</h2>
    <form id="submit-project-form" class="bg-white p-4 rounded shadow-sm">
      <div class="mb-3">
        <label for="emailIntervenant" class="form-label fw-bold">Email Intervenant</label>
        <input type="email" class="form-control" id="emailIntervenant" placeholder="Entrez votre email" required>
      </div>
      <!-- District, Reason, Start, End, Title, Description comme pour la requête -->
      <div class="mb-3">
        <label for="project-district" class="form-label fw-bold">District</label>
        <select class="form-select" id="project-district" required>
            <option value="">Sélectionnez un district</option>
            <option value="LaSalle">LaSalle</option>
            <option value="Dollard-des-Ormeaux">Dollard des Ormeaux</option>
            <option value="Côte-Saint-Luc">Côte Saint-Luc</option>
            <option value="Villeray-Saint-Michel-Parc-Extension">Villeray Saint-Michel Parc Extension</option>
            <option value="Rosemont-La Petite-Patrie">Rosemont La Petite Patrie</option>
            <option value="Hampstead">Hampstead</option>
            <option value="Senneville">Senneville</option>
            <option value="Le Plateau-Mont-Royal">Le Plateau Mont-Royal</option>
            <option value="Sainte-Anne-de-Bellevue">Sainte-Anne-de-Bellevue</option>
            <option value="Montréal-Ouest">Montréal Ouest</option>
            <option value="Côte-des-Neiges-Notre-Dame-de-Grâce">Côte des Neiges Notre-Dame de Grâce</option>
            <option value="L'Île-Bizard-Sainte-Geneviève">L'Île-Bizard-Sainte-Geneviève</option>
            <option value="Beaconsfield">Beaconsfield</option>
            <option value="Anjou">Anjou</option>
            <option value="Verdun">Verdun</option>
            <option value="Le Sud-Ouest">Le Sud-Ouest</option>
            <option value="Mercier-Hochelaga-Maisonneuve">Mercier Hochelaga-Maisonneuve</option>
            <option value="Montréal-Est">Montréal-Est</option>
            <option value="Lachine">Lachine</option>
            <option value="Saint-Léonard">Saint-Léonard</option>
            <option value="Montréal-Nord">Montréal-Nord</option>
            <option value="Outremont">Outremont</option>
            <option value="L'Île-Dorval">L'Île-Dorval</option>
            <option value="Mont-Royal">Mont-Royal</option>
            <option value="Pointe-Claire">Pointe-Claire</option>
            <option value="Dorval">Dorval</option>
            <option value="Pierrefonds-Roxboro">Pierrefonds-Roxboro</option>
            <option value="Rivière-des-Prairies-Pointe-aux-Trembles">Rivière-des-Prairies-Pointe-aux-Trembles</option>
            <option value="Ahuntsic-Cartierville">Ahuntsic-Cartierville</option>
            <option value="Saint-Laurent">Saint-Laurent</option>
            <option value="Ville-Marie">Ville-Marie</option>
            <option value="Kirkland">Kirkland</option>
            <option value="Baie-D'Urfé">Baie-D'Urfé</option>
            <option value="Westmount">Westmount</option>
          </select>          
      </div>
      
      <div class="mb-3">
        <label for="project-reason" class="form-label fw-bold">Raison</label>
        <select class="form-select" id="project-reason" required>
          <option value="">Sélectionnez une raison</option>
          <option value="Travaux_routiers">Travaux routiers</option>
          <option value="Travaux_résidentiel">Travaux résidentiels</option>
          <option value="Construction_ou_rénovation">Construction ou rénovation</option>
          <option value="Entretien_urbain">Entretien urbain</option>
          <option value="Travaux_souterrains">Travaux souterrains</option>
        </select>
      </div>

      <div class="mb-3">
        <label for="project-title" class="form-label fw-bold">Titre du Projet</label>
        <input type="text" class="form-control" id="project-title" placeholder="Entrez le titre du projet" required>
      </div>

      <div class="mb-3">
        <label for="project-description" class="form-label fw-bold">Description</label>
        <textarea class="form-control" id="project-description" rows="3" placeholder="Description du projet" required></textarea>
      </div>

      <div class="mb-3">
        <label for="project-start" class="form-label fw-bold">Date de Début</label>
        <input type="date" class="form-control" id="project-start" required>
      </div>

      <div class="mb-3">
        <label for="project-end" class="form-label fw-bold">Date de Fin</label>
        <input type="date" class="form-control" id="project-end" required>
      </div>

      <button type="submit" class="btn btn-primary w-100">Soumettre le Projet</button>
    </form>
  </div>

  <script src="js/api.js"></script>
  <script src="js/main.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
  const form = document.getElementById('submit-project-form');
  
  form.addEventListener('submit', async function (e) {
    e.preventDefault();
    
    const emailIntervenant = document.getElementById('emailIntervenant').value.trim();
    const district = document.getElementById('project-district').value;
    const reason = document.getElementById('project-reason').value;
    const title = document.getElementById('project-title').value.trim();
    const description = document.getElementById('project-description').value.trim();
    const startDate = document.getElementById('project-start').value;
    const endDate = document.getElementById('project-end').value;

    // Ajout de logs pour vérifier les données envoyées
    console.log({
      emailIntervenant,
      district,
      reason,
      title,
      description,
      startDate,
      endDate,
    });

    if (!emailIntervenant || !district || !reason || !title || !description || !startDate || !endDate) {
      alert('Tous les champs sont obligatoires.');
      return;
    }

    const startISO = startDate + "T00:00:00Z";
    const endISO = endDate + "T00:00:00Z";

    try {
      const response = await fetch('http://localhost:3000/api/projects', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include',
        body: JSON.stringify({
          emailIntervenant,
          reason,
          district,
          start: startISO,
          end: endISO,
          title,
          description,
        }),
      });

      const data = await response.json();
      console.log('Réponse du serveur:', data);

      if (!response.ok) {
        throw new Error(data.message || 'Erreur lors de la soumission du projet.');
      }

      alert('Projet soumis avec succès !');
      form.reset();
    } catch (error) {
      console.error('Erreur:', error);
      alert(error.message);
    }
  });
});

</script>


</body>
</html>